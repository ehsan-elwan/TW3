<!doctype html>
<html class="no-js" lang="fr">

    <head>
        <meta charset="utf-8">
        <meta name="author" content="John Doe">
        <meta name="description" content="">
        <meta name="keywords" content="HTML,CSS,XML,JavaScript">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Title -->
        <title>Home</title>
        <!-- Place favicon.ico in the root directory -->
        <link rel="shortcut icon" type="image/ico" href="images/favicon.ico" />
        <!-- Plugin-CSS -->
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/owl.carousel.min.css">
        <link rel="stylesheet" href="css/themify-icons.css">
        <link rel="stylesheet" href="css/magnific-popup.css">
        <link rel="stylesheet" href="css/animate.css">
        <!-- Main-Stylesheets -->
        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="css/responsive.css">
        <script src="js/vendor/modernizr-2.8.3.min.js"></script>




        <!--[if lt IE 9]>
            <script src="//oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
            <script src="//oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>

    <body class="loading" data-spy="scroll" data-target="#primary-menu">


        <div class="preloader">
            <div class="sk-folding-cube">
                <div class="sk-cube1 sk-cube"></div>
                <div class="sk-cube2 sk-cube"></div>
                <div class="sk-cube4 sk-cube"></div>
                <div class="sk-cube3 sk-cube"></div>
            </div>
        </div>
        <!--Mainmenu-area-->
        <div class="mainmenu-area nav" data-spy="affix" data-offset-top="100">
            <div class="container-fluid">
                <!--Logo-->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#primary-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a href="#" class="navbar-brand logo">
                        <h5>INU Champollion</h5>
                        <h6>Trouvez votre Master</h6>
                    </a>
                </div>
                <!--Logo/-->
                <nav class="collapse navbar-collapse" id="primary-menu">
                    <ul class="nav navbar-nav navbar-right">
                        <li class="active">
                            <a href="#master-map">
                                <span class="glyphicon glyphicon-education"></span>
                                Trouver votre Master
                            </a>
                            
                        </li>
                        <li>
                            <a href="#add-master">
                                <span class="glyphicon glyphicon-plus"></span>
                                Ajouter un master
                            </a>
                        </li>
                        <li>
                            <a href="#static">
                                <span class="glyphicon glyphicon-stats"></span>
                                Statistiques
                            </a>
                        </li>
                        <!--
                        <li><a href="#price-page">Classements</a></li>
                        /-->
                        <li>
                            <a href="#ex-student">
                                <span class="glyphicon glyphicon-user"></span>
                                Ancien élèves
                            </a>
                        </li>
                        <li>
                            <a href="#faq-page">
                                <span class="glyphicon glyphicon-question-sign"></span>
                                FAQ
                            </a>
                        </li>
                        <li>
                            <a href="#contact-page">
                                <span class="glyphicon glyphicon-comment"></span>
                                Contact
                            </a>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <span class="glyphicon glyphicon-log-in"></span>
                                 Connexion
                                <span class="caret"></span>
              
                            </a>
                            
                            <ul id="login-dp" class="dropdown-menu">
				<li>
                                    <div class="row">
					<div class="col-md-12">Se connecter
                                            <form class="form" role="form" method="post" action="LoginController" accept-charset="UTF-8">
						<div class="form-group">
                                                    <label class="sr-only" for="login">Email address</label>
                                                    <input type="email" class="form-control" name="login" placeholder="Adresse email" required>
						</div>
						<div class="form-group">
                                                    <label class="sr-only" for="pass">Password</label>
                                                    <input type="password" class="form-control" name="pass" placeholder="Mot de passe" required>
                                                    <div class="help-block text-right">
                                                        <a href="https://www.univ-jfc.fr">Mot de pass oublié ?</a>
                                                    </div>
						</div>
						<div class="form-group">
                                                    <button type="submit" class="btn btn-primary btn-block">Se connecter</button>
						</div>
                                                <div class="checkbox">
                                                    <!-- 
                                                         <label>
                                                         <input type="checkbox"> keep me logged-in
                                                         </label>
                                                     -->
                                                </div>
                                            </form>
					</div>
                                        <div class="bottom text-center">
                                                Rejoignez nous  <a target="_blank" href="https://www.univ-jfc.fr">
                                                    <b>INU Champollion</b>
                                                </a>                 
                                        </div>
                                    </div>
				</li>
                            </ul>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        <!--Mainmenu-area/-->



        <!--Header-area-->
        <header class="header-area overlay full-height relative v-center" id="master-map">
            <div class="container-fluid maintheme">
                <div class="col-md-6 form-line mapcont">
                    <div class="form-control" id="map"></div>
                </div>

                <div class="col-md-6 form-line sercont">
                    <div class="col-md-10 form-group full-width">

                        <div class="input-group">
                            <input id="search_form" class="form-control input" placeholder="Recherche par mot clé" required>
                            <div class="input-group-btn">
                                <button class="ui btn btn-default form-control" onclick="searchFormations()">
                                    <i class="glyphicon glyphicon-search"></i>
                                    <i class="fa fa-spinner fa-spin btn-spin"></i>
                                </button>
                            </div>

                        </div>

                        <div class="form-check testimonial">

                            <label class="toggle block">
                                <input type="radio" name="toggle" value="mot clé" checked> <span class="label-text">mot clé</span>
                            </label>

                            <label class="toggle block" >
                                <input type="radio" name="toggle" value="ville"> <span class="label-text">ville</span>
                            </label>

                            <label class="toggle block">
                                <input type="radio" name="toggle" value="sigle"> <span class="label-text">sigle</span>
                            </label>
                        </div>
                        <input id="filter_input" name="filter" type="hidden" value="mot clé">
                        
                        


                    </div> 
                    <div class="col-md-10 form-group centerediv">
                        <button class="ui button btn-tw form-control" type="button" onclick="searchAllFormations()">
                            <i class="fa fa-spinner fa-spin btn-spin"></i>
                            Afficher toutes les Master
                        </button>
                    </div>
                    <div id="div1" data-special-value="${sessionScope.msg}" style="width: 30px; height: 30px;">
           
                    </div>
                    <div id="dropinfo" class="col-md-10 form-group">
                    </div>
                </div>
               
            </div>
        </header>
        <!--Header-area/-->




        <!--Feature-area-->
        <section class="gray-bg section-padding" id="add-master">
            <section class="angle-bg sky-bg section-padding">
                <div class="contact-section">
                    <div class="section-content">
                        <h1 class="section-header">Ajouter <span class="content-header wow fadeIn " data-wow-delay="0.2s" data-wow-duration="2s"> une master</span></h1>
                    </div>
                    <div class="container">

                        <form>
                            <div class="col-md-6 form-line">
                                <div class="col-md-12 form-group">
                                    <label>Intitulé</label>
                                    <input class="form-control input" name="ville" type="text" placeholder="Quelle est l'intitulé du master ?" required> 
                                </div>
                                <div class="col-md-6 form-line">
                                    <label>type</label>
                                    <input class="form-control input" name="type" type="text" placeholder="Quelle est le type du master ?" required>
                                </div>	
                                <div class="col-md-6 form-line">
                                    <label>Sigle</label>
                                    <input class="form-control input" name="sigle" type="text" placeholder="Sigle de formation ?" required>
                                </div>
                                


                            </div>
                            <div class="col-md-6 form-line">
                                <div class="col-md-12 form-group">
                                    <label>Specialité</label>
                                    <input class="form-control input" name="specialte" type="text" placeholder="Quelle est votre spécialité ?" required>
                                </div>
                                <div class="col-md-12 form-group">
                                    <label>Etablissement</label>
                                    <a id="etlab_name" class="form-control input" data-toggle="dropdown" href="#">Veuillez choisir un établissement <span class="caret"></span></a>
                                    <ul id="etabdp" class="dropdown-menu etabdp"></ul>                          
                                    <input id="etab_id" name="etablissement" type="hidden" value="">
                                </div>
                            </div>
                            <div>
                                <button type="button" class="ui button btn-tw btn-block">
                                    <span class="glyphicon glyphicon-plus"></span> Ajoute
                                </button>
                            </div>
                        </form>
                    </div>
            </section>
            <!--Feature-area/-->

        </section>

        <section class="gray-bg section-padding" id="static">

            <div class="contact-section">
                <div class="section-content">
                    <div class="section-content">
                        <h1 class="section-header" id="stat">Stati<span class="content-header wow fadeIn " data-wow-delay="0.2s" data-wow-duration="2s">ques</span></h1>
                    </div>
                    <div class="container">
                        <div id="graph0" style="height: 500px;"></div>
                        <div id="graph1" style="height: 500px;"></div>
                    </div>
                </div>
            </div>
        </section>

        
        <!--
        <section class="price-area overlay section-padding" id="price-page">

        </section>
        /-->



        <section class="section-padding gray-bg" id="ex-student">

        </section>



        <section class="testimonial-area section-padding gray-bg overlay">

        </section>



        <section class="gray-bg section-padding" id="faq-page">

        </section>



        <section class="section-padding overlay client-area overlay" id="client-page">

        </section>


        <section class="section-padding gray-bg" id="blog-page">
            <div class="container">

            </div>
        </section>



        <footer class="footer-area relative sky-bg" id="contact-page">
            <div class="absolute footer-bg"></div>
            <div class="footer-top">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12 col-sm-6 col-sm-offset-3 text-center">
                            <div class="page-title">
                                <h2>Contactez nous</h2>
                                <p></p>
                            </div>
                        </div>
                    </div>
                    <div class="row" >
                        <div class="col-xs-12 col-md-4">
                            <address class="side-icon-boxes">
                                <div class="side-icon-box">
                                    <div class="side-icon">
                                        <img src="images/location-arrow.png" alt="">
                                    </div>
                                    <p><strong>Address: </strong> Place de Verdun <br />81 012 Albi</p>
                                </div>
                                <div class="side-icon-box">
                                    <div class="side-icon">
                                        <img src="images/phone-arrow.png" alt="">
                                    </div>
                                    <p ><strong>Telephone: </strong>
                                        <a style="color:black;" href="callto:0563481717">05 63 48 17 17</a> <br />
                                        <a style="color:black;" href="callto:0563481717">05 63 48 17 17</a>
                                    </p>
                                </div>
                                <div class="side-icon-box">
                                    <div class="side-icon">
                                        <img src="images/mail-arrow.png" alt="">
                                    </div>
                                    <p><strong>E-mail: </strong>
                                        <a style="color:black;" href="mailto:youremail@example.com">youremail@example.com</a> <br />
                                        <a style="color:black;" href="mailto:youremail@example.com">example@mail.com</a>
                                    </p>
                                </div>
                            </address>
                        </div>
                        <div class="col-xs-12 col-md-8">
                            <form action="process.php" id="contact-form" method="post" class="contact-form">
                                <div class="form-double">
                                    <input type="text" id="form-name" name="form-name" placeholder="Your name" class="form-control" required="required">
                                    <input type="email" id="form-email" name="form-email" class="form-control" placeholder="E-mail address" required="required">
                                </div>
                                <input type="text" id="form-subject" name="form-subject" class="form-control" placeholder="Message topic">
                                <textarea name="message" id="form-message" rows="5" class="form-control" placeholder="Your message" required="required"></textarea>
                                <button type="submit" class="ui button btn-tw">Submit</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer-middle">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12 col-sm-6 pull-right">
                            <ul class="social-menu text-right x-left">
                                <li><a href="https://www.facebook.com/enseignementsup.recherche/"><i class="ti-facebook"></i></a></li>
                                <li><a href="https://twitter.com/sup_recherche"><i class="ti-twitter"></i></a></li>
                                <li><a href="#"><i class="ti-google"></i></a></li>
                                <li><a href="#"><i class="ti-linkedin"></i></a></li>
                                <li><a href="#"><i class="ti-github"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </footer>

        <div class="modal"></div>


        <script src="js/vendor/jquery-1.12.4.min.js"></script>

        <script src="js/vendor/bootstrap.min.js"></script>
        <script async defer
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAxiPjQwKrmWhkfyjPaNH-hOE6k4vSDaYE">
        </script>
        <!--Plugin-JS-->
        <script src="js/owl.carousel.min.js"></script>
        <script src="js/contact-form.js"></script>
        <script src="js/jquery.parallax-1.1.3.js"></script>
        <script src="js/scrollUp.min.js"></script>
        <script src="js/magnific-popup.min.js"></script>
        <script src="js/wow.min.js"></script>
        <!--Main-active-JS-->
        <script src="js/main.js"></script>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript">


            var $body = $("body");
            var geocoder;
            var map;
            var nextAddress = -1;
            var delay = 100;
            var bounds;
            var infowindow;
            var icons = 'sc.png';
            var ser_lat_lng = [];
            var gmark = [];
            var donefac = [];

            $(document).on({
                ajaxStop: function () {
                    $body.removeClass("loading");
                }
            });

            function initialize() {

            
                geocoder = new google.maps.Geocoder();
                bounds = new google.maps.LatLngBounds();
                infowindow = new google.maps.InfoWindow();
                var latlng = new google.maps.LatLng(46.6382444, 3.2481221);
                var mapOptions = {
                    zoom: 6,
                    center: latlng
                };
                map = new google.maps.Map(document.getElementById('map'), mapOptions);

                $.ajax({
                    url: "Student",
                    data: {"set": "getEstablishment"},
                    dataType: "json",
                    error: showError,
                    success: // La fonction qui traite les résultats
                            function (results) {
                                var myUl = $("#etabdp");
                                var li;
                                var aOp;
                                results.map((res) => {
                                    aOp = $('<a>' + res.sch_name + '</a>').attr({'id': res.sch_id, 'href': '#'});
                                    li = $('<li> </li>').append(aOp);
                                    myUl.append(li);

                                });
                                $(".dropdown-menu li a").click(function (event) {
                                    event.preventDefault();
                                    var selText = $(this).text();
                                    var v = $(this).attr("id");
                                    var elem = $("#etlab_name");
                                    console.log(v);

                                    elem.html(selText + ' <span class="caret"></span>');

                                    $("#etab_id").val(v);
                                });
                                $body.removeClass("loading");
                            }
                });
                
                //Listener:
                $("input[name=toggle]").change(function(){
                    var e =$('#search_form');
                    var value=$(this).val();
                    e.attr('placeholder',"Recherche par "+value);
                    $("#filter_input").val(value);
                });
                drawChart();
                $(".btn-spin").hide();
            }

            function drawChart() {


                $.ajax({
                    url: "Student",
                    data: {"set": "graph0"},
                    dataType: "json",
                    async: true,
                    error: function (a, b, c) {
                        console.log(b);
                    },
                    success: function (res) {

                        var array = [["Sigle", "Average", {role: 'style'}]];
                        for (key in res) {
                            array.push([key, res[key], 'color: ' + getRandomColor()]);

                        }
                        var data = new google.visualization.arrayToDataTable(array);
                        var options = {
                            chart: {
                                title: 'Students average',
                                subtitle: 'Students average in all Spec: 2014-2017'

                            },
                            animation: {
                                duration: 1000,
                                easing: 'inAndOut',
                                startup: true
                            },
                            backgroundColor: '#f2fefe',
                            is3D: true
                        };
                        var chartg1 = new google.visualization.ColumnChart(document.getElementById('graph0'));
                        chartg1.draw(data, options);
                    }
                });

                $.ajax({
                    url: "Student",
                    data: {"set": "graph1"},
                    dataType: "json",
                    async: true,
                    success: function (res) {

                        var array = [["Graph_1", "Employed students ", "Looking for a job", "In school"]];
                        for (key in res) {
                            var tmp = res[key][0];
                            array.push([key, tmp.withjob, tmp.withoutjob, tmp.insch]);
                        }
                        var data = new google.visualization.arrayToDataTable(array);
                        var options = {
                            chart: {
                                title: 'Students status',
                                subtitle: 'Employed students, looking for a job, in school: 2014-2017'
                            },
                            animation: {
                                duration: 1000,
                                easing: 'inAndOut',
                                startup: true
                            },
                            isStacked: true,
                            backgroundColor: '#f2fefe',
                            is3D: true

                        };
                        var chartg2 = new google.visualization.ColumnChart(document.getElementById('graph1'));
                        chartg2.draw(data, options);
                    }
                });
            }
            ;

            function getRandomColor() {
                var letters = '0123456789ABCDEF';
                var color = '#';
                for (var i = 0; i < 6; i++) {
                    color += letters[Math.floor(Math.random() * 16)];
                }
                return color;
            }

            function showError(xhr, status, message) {
                alert(JSON.parse(xhr.responseText).message);
            }
            function setMapOnAll(map) {
                for (var i = 0; i < gmark.length; i++) {
                    gmark[i].setMap(map);
                }
            }

            function clearMarkers() {
                $("button.ui").attr("disabled", true);
                $(".btn-spin").show();
                setMapOnAll(null);
                ser_lat_lng = [];
                gmark = [];
                nextAddress = -1;
            }

            function toggleBounce(mk) {
                if (mk.getAnimation() !== null) {
                    mk.setAnimation(null);
                } else {
                    mk.setAnimation(google.maps.Animation.BOUNCE);
                }
            }

            function createMarker(add, lat, lng) {


                var marker = new google.maps.Marker({
                    position: new google.maps.LatLng(lat, lng),
                    animation: google.maps.Animation.DROP,
                    icon: icons,
                    map: map
                });

                google.maps.event.addListener(marker, 'click', function () {
                    infowindow.setContent(add);
                    infowindow.open(map, marker);
                    marker.setAnimation(google.maps.Animation.BOUNCE);
                    setTimeout(function () {
                        marker.setAnimation(null);
                    }, 700);
                });

                gmark.push(marker);
                marker.setMap(map);
                bounds.extend(marker.position);

            }


            function getAddress(search) {

                var lat;
                var lng;
                var add = search.split(';')[0];
                var fac = search.split(';')[2];
                if (donefac.indexOf(fac) > -1) {
                    //
                } else {
                    geocoder.geocode({address: add}, function (results, status) {
                        if (status === google.maps.GeocoderStatus.OK) {

                            var p = results[0].geometry.location;
                            lat = p.lat();
                            lng = p.lng();
                            ser_lat_lng.push([search, lat, lng]);
                            donefac.push(fac);
                        } else {
                            if (status === google.maps.GeocoderStatus.OVER_QUERY_LIMIT) {
                                nextAddress--;
                                delay++;
                            }
                        }
                    });
                }
            }


            function theNext(addresses) {

                if (nextAddress < addresses.length - 1) {

                    setTimeout(function () {
                        getAddress(addresses[nextAddress]);

                        theNext(addresses);
                    }, delay);
                    nextAddress++;
                } else {
                    ser_lat_lng.map((res) => {
                        var add = res[0].split(';');
                        createMarker(add[1] + " <PRE> <b> " + add[2], res[1], res[2]);
                    });
                    map.fitBounds(bounds);
                    $("#dropinfo").removeClass("loading").show();
                    $("#map").removeClass("loading");
                    $("button.ui").attr("disabled", false);
                    $(".btn-spin").hide();
                }
            }


            function searchFormations() {
                clearMarkers();
                ser_lat_lng = [];
                donefac = [];
                cities = [];
                var maindiv = $("#dropinfo");
                maindiv.empty();
                var form = $("#search_form").val();
                var value=$("#filter_input").val();
                var callfun;
                switch(value) {
                    case "ville":
                        callfun="getFormationByCity";
                        break;
                    case "sigle":
                        callfun="getFormationByCity";
                        break;
                    default:
                        callfun="getFormationsLikeLabel";
                }
                $.ajax({
                    url: "Student",
                    data: {"set": callfun, "form_lab": form},
                    dataType: "json",
                    error: showError,
                    success: // La fonction qui traite les résultats
                            function (results) {
                                var cities = [];
                                var str;
                                var cityc;
                                var sch_name;
                                var div;

                                results.map((res) => {
                                    cityc = res.sch.sch_city + " ( " + res.sch.posteCode + " )";
                                    sch_name = res.sch.sch_name;
                                    str = res.sch.sch_city + ", " + res.sch.sch_country +
                                            " ; " + cityc + ";" + sch_name;
                                    cities.push(str);
                                    var tt = parse("<div class='col-xs-3 form-line'><header >"
                                            + "<a> %s</a></header><h4><a href='#'>%s</a></h4><p >"
                                            + "%s</p><p >%s"
                                            + "</p></div><div class='col-xs-2 form-line'><span ><img src='images/sch_avatar/%s.png'"
                                            + " alt=''></span><div class='SavoirPlus'><a target='_blank' "
                                            + "href='http://www.google.com/search?q=%s'>"
                                            + "<span>En savoir plus</span></a></div></div><hr>", res.sigle, res.for_intitule, sch_name, cityc, res.sch.sch_id, sch_name);
                                    div = $('<div> ' + tt + ' </div>').attr({"id": res.sch.sch_id, "class": "container dropdiv"});
                                    maindiv.append(div);

                                });
                                theNext(cities);

                            }
                });

            }
            function searchAllFormations() {
                clearMarkers();
                ser_lat_lng = [];
                donefac = [];
                cities = [];
                var dropelement = $("#dropinfo");
                dropelement.empty();
                $.ajax({
                    url: "Student",
                    data: {"set": "getAllFormations"},
                    dataType: "json",
                    error: showError,
                    success: // La fonction qui traite les résultats
                            function (results) {
                                var cities = [];
                                var str;
                                var cityc;
                                var sch_name;
                                var div;

                                results.map((res) => {
                                    cityc = res.sch.sch_city + " ( " + res.sch.posteCode + " )";
                                    sch_name = res.sch.sch_name;
                                    str = res.sch.sch_city + ", " + res.sch.sch_country +
                                            " ; " + cityc + ";" + sch_name;
                                    cities.push(str);
                                    var tt = parse("<div class='col-xs-3 form-line'><header >"
                                            + "<a> %s</a></header><h4><a href='#'>%s</a></h4><p >"
                                            + "%s</p><p >%s"
                                            + "</p></div><div class='col-xs-2 form-line'><span ><img src='images/sch_avatar/%s.png'"
                                            + " alt=''></span><div class='SavoirPlus'><a target='_blank' "
                                            + "href='http://www.google.com/search?q=%s'>"
                                            + "<span>En savoir plus</span></a></div></div><hr>", res.sigle, res.for_intitule, sch_name, cityc, res.sch.sch_id, sch_name);
                                    div = $('<div> ' + tt + ' </div>').attr({"id": res.sch.sch_id, "class": "container dropdiv"});
                                    $("#dropinfo").append(div);

                                });
                                theNext(cities);

                            }
                });
            }

            function parse(str) {
                var args = [].slice.call(arguments, 1),
                        i = 0;

                return str.replace(/%s/g, function () {
                    return args[i++];
                });
            }

            google.charts.load('visualization', {'packages': ['bar', 'corechart']});
            google.charts.setOnLoadCallback(initialize);
        </script>

    </body>

</html>


