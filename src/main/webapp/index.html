<!doctype html>
<html class="no-js" lang="fr">

    <head>
        <meta charset="utf-8">
        <meta name="author" content="John Doe">
        <meta name="description" content="">
        <meta name="keywords" content="HTML,CSS,XML,JavaScript">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Title -->
        <title>Home</title>
        <!-- Place favicon.ico in the root directory -->
        <link rel="shortcut icon" type="image/ico" href="images/favicon.ico" />
        <!-- Plugin-CSS -->
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/owl.carousel.min.css">
        <link rel="stylesheet" href="css/themify-icons.css">
        <link rel="stylesheet" href="css/magnific-popup.css">
        <link rel="stylesheet" href="css/animate.css">

        <!-- Main-Stylesheets -->
        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="css/responsive.css">             
        <link rel="stylesheet" href="css/bootstrap-slider.min.css" />


        <!--[if lt IE 9]>
            <script src="//oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
            <script src="//oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>

    <body class="loading" data-spy="scroll" data-target="#primary-menu">


        <div class="preloader">
            <div class="sk-folding-cube">
                <div class="sk-cube1 sk-cube"></div>
                <div class="sk-cube2 sk-cube"></div>
                <div class="sk-cube4 sk-cube"></div>
                <div class="sk-cube3 sk-cube"></div>
            </div>
        </div>
        <!--Mainmenu-area-->
        <div class="mainmenu-area nav" data-spy="affix" data-offset-top="100">
            <div class="container-fluid">
                <!--Logo-->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#primary-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a href="#" class="navbar-brand logo">
                        <h5>INU Champollion</h5>
                        <h6>Trouvez votre Master</h6>
                    </a>
                </div>
                <!--Logo/-->
                <nav class="collapse navbar-collapse" id="primary-menu">
                    <ul class="nav navbar-nav navbar-right">
                        <li class="active">
                            <a href="#master-map">
                                <span class="glyphicon glyphicon-education"></span>
                                Trouver votre Master
                            </a>
                        </li>
                        <li class="element-to-hide">
                            <a href="#add-master">
                                <span class="glyphicon glyphicon-plus"></span>
                                Ajouter un master
                            </a>
                        </li>
                        <li>
                            <a href="#static">
                                <span class="glyphicon glyphicon-stats"></span>
                                Statistiques
                            </a>
                        </li>
                        <!--
                        <li><a href="#price-page">Classements</a></li>
                        /-->
                        <li class="element-to-hide">
                            <a href="#ex-student">
                                <span class="glyphicon glyphicon-user"></span>
                                Ancien élèves
                            </a>
                        </li>
                        <li>
                            <a href="#faq-page">
                                <span class="glyphicon glyphicon-question-sign"></span>
                                FAQ
                            </a>
                        </li>
                        <li>
                            <a href="#contact-page">
                                <span class="glyphicon glyphicon-comment"></span>
                                Contact
                            </a>
                        </li>
                        <li class="dropdown">
                            <a id="user-tag" href="#" class="dropdown-toggle" data-toggle="dropdown" title="Connexion">
                                <span class="glyphicon glyphicon-log-in"></span>
                                Connexion
                                <span class="caret"></span>

                            </a>

                            <ul id="login-dp" class="dropdown-menu">
                                <li>
                                    <div class="row">
                                        <div class="col-md-12">Se connecter
                                            <form class="form" role="form" accept-charset="UTF-8">
                                                <div class="form-group">
                                                    <label class="sr-only" for="login">Email address</label>
                                                    <input id="login-id" type="email" class="form-control" name="login" placeholder="Adresse email" required>
                                                </div>
                                                <div class="form-group">
                                                    <label class="sr-only" for="pass">Password</label>
                                                    <input id="pass-id" type="password" class="form-control" name="pass" placeholder="Mot de passe" required>
                                                    <div class="help-block text-right">
                                                        <a href="https://www.univ-jfc.fr">Mot de pass oublié ?</a>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <button id="conn-btn" type="submit" class="btn btn-primary btn-block">Se connecter</button>
                                                </div>
                                                <div class="checkbox">
                                                    <!--
                                                         <label>
                                                         <input type="checkbox"> keep me logged-in
                                                         </label>
                                                    -->
                                                </div>
                                            </form>
                                        </div>
                                        <div class="bottom text-center">
                                            Rejoignez nous  <a target="_blank" href="https://www.univ-jfc.fr">
                                                <b>INU Champollion</b>
                                            </a>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </li>
                        <li id = "logout-dp" style="display: none;">
                            <a id="deconn-btn" href="#" title="Déconnexion">
                                <span class="glyphicon glyphicon-log-out"></span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        <!--Mainmenu-area/-->



        <!--Header-area-->
        <header class="header-area overlay full-height relative v-center" id="master-map">
            <div class="container-fluid maintheme">
                <div class="col-md-6 form-line mapcont">
                    <div class="form-control" id="map"></div>
                </div>
                <div class="col-md-6 form-line sercont">
                    <div class="col-md-10 form-group full-width">

                        <div class="input-group">
                            <input id="search_form" class="form-control input wrap-input" placeholder="Recherche par mot clé" required>
                            <div class="input-group-btn">
                                <button class="ui btn btn-default form-control" onclick="searchFormations()">
                                    <i class="glyphicon glyphicon-search"></i>
                                    <i class="fa fa-spinner fa-spin btn-spin"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-check testimonial">

                            <label class="toggle block">
                                <input type="radio" name="toggle" value="mot clé" checked> <span class="label-text">mot clé</span>
                            </label>

                            <label class="toggle block" >
                                <input type="radio" name="toggle" value="ville"> <span class="label-text">ville</span>
                            </label>

                            <label class="toggle block">
                                <input type="radio" name="toggle" value="sigle"> <span class="label-text">sigle</span>
                            </label>
                        </div>
                        <input id="filter_input" name="filter" type="hidden" value="mot clé">
                    </div>
                    <div class="col-md-10 form-group centerediv">
                        <button class="ui button btn-tw form-control" type="button" onclick="searchAllFormations()">
                            <i class="fa fa-spinner fa-spin btn-spin"></i>
                            Afficher toutes les Master
                        </button>
                    </div>
                </div>
                <div id="dropinfo" class="col-md-10 form-group" style="width: 40%;">
                </div>
            </div>
        </header>
    <!--Header-area/-->


    <!--Feature-area-->
    <section class="gray-bg section-padding element-to-hide" id="add-master">
        
            <div class="contact-section">
                <div class="section-content" style="padding-left: 60px;">
                    <h1 class="section-header"><span class="content-header wow fadeIn " data-wow-delay="0.5s" data-wow-duration="5s">Ajouter un master</span></h1>
                </div>
                <div class="container" style="padding-top: 30px;"> 
                    <form id ="add-formation">                     
                        <div class="col-md-6 form-line">
                            <div class="col-md-12 form-group">
                                <label>Intitulé</label>
                                <input class="form-control input wrap-input" name="title" type="text" placeholder="Quelle est l'intitulé du master ?" required size="20" minlength="4" maxlength="20">
                            </div>
                            <div class="col-md-6 form-line">
                                <label>type</label>
                                <input class="form-control input wrap-input" name="type" type="text" placeholder="Quelle est le type du master ?" required size="15" minlength="4" maxlength="15">
                            </div>
                            <div class="col-md-6 form-line">
                                <label>Sigle</label>
                                <input class="form-control input wrap-input" name="sigle" type="text" placeholder="Sigle de formation ?" required size="7" minlength="2" maxlength="7">
                            </div>
                        </div>
                        <div class="col-md-6 form-line">
                            <div class="col-md-12 form-group">
                                <label>Specialité</label>
                                <input class="form-control input wrap-input" name="spec" type="text" placeholder="Quelle est votre spécialité ?" required required size="15" minlength="2" maxlength="15">
                            </div>
                            <div class="col-md-12 form-group">
                                <label>Etablissement</label>
                                <a id="etlab_name" class="form-control input wrap-input" data-toggle="dropdown" href="#">Veuillez choisir un établissement <span class="caret"></span></a>
                                <ul id="etabdp" class="dropdown-menu etabdp"></ul>
                                <input id="etab_id" name="sch-id" type="hidden" value="">
                                <input name="todo" type="hidden" value="add_formation">
                            </div>
                        </div>
                        <div>
                            <button type="submit" class="ui button btn-tw btn-block" style=" margin: 10px auto; width: 30%;">
                                   <span class="glyphicon glyphicon-plus"></span> Ajoute
                            </button>
                            <div id = "alert-div" style="padding-top:20px;"></div>
                          
                        </div>
                    </form>
                </div>
            </div>
        
        <!--Feature-area/-->

    </section>

    <section class="gray-bg section-padding" id="static">

        <div class="contact-section">
            <div class="section-content">
                <div class="section-content" style="padding-left: 60px;">
                    <h1 class="section-header" id="stat"><span class="content-header wow fadeIn " data-wow-delay="0.5s" data-wow-duration="5s">Statiques</span></h1>
                </div>
                <div class="container" style="padding-top: 30px;">
                    <p id="year-slider" class="testimonial"> Moyenne par master</p>
                    <div id="chart_graph0" style="height: 500px;"></div>
                    <p class="testimonial"> Situation des étudiants</p>
                    <div id="graph1"></div>
                </div>
            </div>
        </div>
    </section>


    <!--
    <section class="price-area overlay section-padding" id="price-page">

    </section>
    /-->



    <section class="section-padding gray-bg" id="ex-student">

    </section>



    <section class="testimonial-area section-padding gray-bg overlay">

    </section>



    <section class="gray-bg section-padding" id="faq-page">

    </section>



    <section class="section-padding overlay client-area overlay" id="client-page">

    </section>


    <section class="section-padding gray-bg" id="blog-page">
        <div class="container">

        </div>
    </section>



    <footer class="footer-area relative sky-bg" id="contact-page">
        <div class="absolute footer-bg"></div>
        <div class="footer-top">
            <div class="container">
                <div class="row">
                    <div class="col-xs-12 col-sm-6 col-sm-offset-3 text-center">
                        <div class="page-title">
                            <h2>Contactez nous</h2>
                            <p></p>
                        </div>
                    </div>
                </div>
                <div class="row" >
                    <div class="col-xs-12 col-md-4">
                        <address class="side-icon-boxes">
                            <div class="side-icon-box">
                                <div class="side-icon">
                                    <img src="images/location-arrow.png" alt="">
                                </div>
                                <p><strong>Address: </strong> Place de Verdun <br />81 012 Albi</p>
                            </div>
                            <div class="side-icon-box">
                                <div class="side-icon">
                                    <img src="images/phone-arrow.png" alt="">
                                </div>
                                <p ><strong>Telephone: </strong>
                                    <a style="color:black;" href="callto:0563481717">05 63 48 17 17</a> <br />
                                    <a style="color:black;" href="callto:0563481717">05 63 48 17 17</a>
                                </p>
                            </div>
                            <div class="side-icon-box">
                                <div class="side-icon">
                                    <img src="images/mail-arrow.png" alt="">
                                </div>
                                <p><strong>E-mail: </strong>
                                    <a style="color:black;" href="mailto:youremail@example.com">youremail@example.com</a> <br />
                                    <a style="color:black;" href="mailto:youremail@example.com">example@mail.com</a>
                                </p>
                            </div>
                        </address>
                    </div>
                    <div class="col-xs-12 col-md-8">
                        <form id="contact-form" class="contact-form">
                            <div class="form-double">
                                <input type="text" id="form-name" name="form-name" placeholder="Your name" class="form-control" required="required">
                                <input type="email" id="form-email" name="form-email" class="form-control" placeholder="E-mail address" required="required">
                            </div>
                            <input type="text" id="form-subject" name="form-subject" class="form-control" placeholder="Message topic">
                            <textarea name="message" id="form-message" rows="5" class="form-control" placeholder="Your message" required="required"></textarea>
                            <button type="submit" class="ui button btn-tw">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-middle">
            <div class="container">
                <div class="row">
                    <div class="col-xs-12 col-sm-6 pull-right">
                        <ul class="social-menu text-right x-left">
                            <li><a href="https://www.facebook.com/enseignementsup.recherche/"><i class="ti-facebook"></i></a></li>
                            <li><a href="https://twitter.com/sup_recherche"><i class="ti-twitter"></i></a></li>
                            <li><a href="#"><i class="ti-google"></i></a></li>
                            <li><a href="#"><i class="ti-linkedin"></i></a></li>
                            <li><a href="#"><i class="ti-github"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <div class="modal"></div>


    <script src="js/vendor/jquery-1.12.4.min.js"></script>
    <script src="js/vendor/bootstrap.min.js"></script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAxiPjQwKrmWhkfyjPaNH-hOE6k4vSDaYE">
    </script>
    <!--Plugin-JS-->
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/contact-form.js"></script>
    <script src="js/jquery.parallax-1.1.3.js"></script>
    <script src="js/scrollUp.min.js"></script>
    <script src="js/magnific-popup.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/vendor/modernizr-2.8.3.min.js"></script>
    <script type="text/javascript" src="js/bootstrap-slider.min.js"></script>
    <!--Main-active-JS-->
    <script src="js/main.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        
        Array.prototype.max = function() {
            return Math.max.apply(null, this);
          };

          Array.prototype.min = function() {
            return Math.min.apply(null, this);
          };


        var $body = $("body");
        var geocoder;
        var map;
        var nextAddress = -1;
        var delay = 100;
        var bounds;
        var infowindow;
        var icons = 'sc2.png';
        var ser_lat_lng = [];
        var gmark = [];
        var donefac = [];

        $(document).on({
            ajaxStop: function () {
                $body.removeClass("loading");
            }
        });
        

        function initialize() {


            geocoder = new google.maps.Geocoder();
            bounds = new google.maps.LatLngBounds();
            infowindow = new google.maps.InfoWindow();
            var latlng = new google.maps.LatLng(46.6382444, 3.2481221);
            var mapOptions = {
                zoom: 6,
                center: latlng
            };
            map = new google.maps.Map(document.getElementById('map'), mapOptions);

            $.ajax({
                url: "Student",
                data: {"set": "getEstablishment"},
                dataType: "json",
                error: showError,
                success: // La fonction qui traite les résultats
                    function (results) {
                        var myUl = $("#etabdp");
                        var li;
                        var aOp;
                        results.map((res) => {
                            aOp = $('<a>' + res.sch_name + '</a>').attr({'id': res.sch_id, 'href': '#'});
                            li = $('<li> </li>').append(aOp);
                            myUl.append(li);
                        });
                        $(".dropdown-menu li a").click(function (event) {
                            event.preventDefault();
                            var selText = $(this).text();
                            var v = $(this).attr("id");
                            var elem = $("#etlab_name");
                            elem.html(selText + ' <span class="caret"></span>');
                            $("#etab_id").val(v);
                         });
                         $body.removeClass("loading");
                    }
            });

            //Listener:
            $("input[name=toggle]").change(function () {
                var e = $('#search_form');
                var value = $(this).val();
                e.attr('placeholder', "Recherche par " + value);
                $("#filter_input").val(value);
            });

            $("#conn-btn").click(function (evt) {
                evt.preventDefault();
                var login = $("#login-id").val();
                var pass = $("#pass-id").val();

                $.ajax({
                    url: "LoginController",
                    data: {"login": login, "pass": pass},
                    dataType: "json",
                    error: function (a, b, c) {
                        console.log(a);
                        console.log(b);
                        console.log(c);
                    },
                    success: // La fonction qui traite les résultats
                        function (results) {
                            var element = '<span class="glyphicon glyphicon-user"></span> '
                            + results.user.st_fname + ' ' + results.user.st_lname;
                            $("#user-tag").empty().append(element);
                            $("#login-dp").hide(1000);
                            $("#logout-dp").show(1000);
                            $(".element-to-hide").show(1000);
                            //alert(results.msg);
                        }
                });
            });
            
            $("#add-formation").submit(function(event){
                event.preventDefault();
                var form_data = $(this).serialize();
                $.ajax({
                    url : "actions",
                    data : form_data,
                    error: function(a,b,c) {
                        alert (a,b,c);
                    },
                    success: function(res) {
                        var e =$("#alert-div");
                        e.empty();
                        var tt = parse("<button type='button' class='close' \n\
                            aria-hidden='true'>&times;</button><p><strong> %s \n\
                            </strong></p>",res.msg);
                        var alertClass;
                        if (res.code === 0) {
                            alertClass = "alert-success";
                        } else {
                            alertClass = "alert-danger";
                        }
                        var newalert = $('<div> ' + tt + ' </div>').attr({"class": "alert "+alertClass+" alert-dismissable"});
                        e.append(newalert);
                        $(".alert button.close").click(function() {
                            $(this).parent().fadeOut('slow');
                        });
                    //alert(res.msg);
                    }
                }); 
            });
            
            //// Listner  /////
            //drawChart();
            drawDashboard();
            $("input.slider").slider();
            $(".btn-spin").hide(1000);
            

        }

        function drawDashboard() {
            var chart;
            var options;
            var data;
            // Create our data table.
            $.ajax({
                url: "Student",
                data: {"set": "graph0"},
                dataType: "json",
                async: true,
                error: function (a, b, c) {
                    console.log(b);
                },
                success: function (res) {
                    var dates=[];
                    var array = [];
                    for (date in res) {                        
                        dates.push(date);            
                    }
                    var maxi=dates.max();
                    for (var i=0; i<res[maxi].length; i++) {
                        array.push([res[maxi][i].sigle,res[maxi][i].sigle,res[maxi][i].avg]);
                    }
                    var myinput = $('<input />').attr({
                            "id": 'slider', "type": 'text', "data-provide": 'slider',
                            "data-slider-ticks":'['+ dates.toString()+']', "data-slider-ticks-labels": '['+ dates.toString()+']',
                            "data-slider-min":dates.min(), "data-slider-max":maxi,
                            "data-slider-step": '1',"data-slider-value":maxi,
                            "data-slider-id":'GC',
                            "data-slider-tooltip": 'hide', "style": 'width: 100%;'});

 
                    data = google.visualization.arrayToDataTable(getPivotArray(array, 0, 1, 2));
                    options = {
                            title: 'Students status',
                            
                            animation: {
                                duration: 1000,
                                easing: 'inAndOut',
                                startup: true
                            },
                            isStacked: true,
                            is3D: true,
                            backgroundColor: '#f2fefe'
                        };
                    chart = new google.visualization.ColumnChart(document.getElementById('chart_graph0'));
                    chart.draw(data,options);
                    $("#year-slider").after(myinput);
                    $("#slider").slider().on("slideStop", function(slideEvt) {
                            var value=slideEvt.value;
                            array=[];
                            for (var i=0; i<res[value].length; i++) {
                                array.push([res[value][i].sigle,res[value][i].sigle,res[value][i].avg]);
                            }
                            data =google.visualization.arrayToDataTable(getPivotArray(array, 0, 1, 2));
                            chart.draw(data,options);
                        });;
                }
            });
            
            $.ajax({
                url: "Student",
                data: {"set": "graph1"},
                dataType: "json",
                async: true,
                success: function (res) {

                    var array = [["Graph_1", "Salarié ", "Recherche Job ", "En formation "]];
                    for (key in res) {
                        var tmp = res[key][0];
                        array.push([key, tmp.withjob, tmp.withoutjob, tmp.insch]);
                    }
                    var data = new google.visualization.arrayToDataTable(array);
                    var options = {
                        chart: {
                            title: 'Students status',
                            subtitle: 'Employed students, looking for a job, in school: 2014-2017'
                        },
                        animation: {
                            duration: 1000,
                            easing: 'inAndOut',
                            startup: true
                        },
                        isStacked: true,
                        backgroundColor: '#f2fefe',
                        is3D: true

                    };
                    var chartg2 = new google.visualization.ColumnChart(document.getElementById('graph1'));
                    chartg2.draw(data, options);
                }
            });
        }
        
        function getRandomColor() {
            var letters = '0123456789ABCDEF';
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function showError(xhr, status, message) {
            alert(JSON.parse(xhr.responseText).message);
        }
        function setMapOnAll(map) {
            for (var i = 0; i < gmark.length; i++) {
                gmark[i].setMap(map);
            }
        }

        function clearMarkers() {
            $("button.ui").attr("disabled", true);
            $(".btn-spin").show(500);
            setMapOnAll(null);
            ser_lat_lng = [];
            gmark = [];
            nextAddress = -1;
        }

        function toggleBounce(mk) {
            if (mk.getAnimation() !== null) {
                mk.setAnimation(null);
            } else {
                mk.setAnimation(google.maps.Animation.BOUNCE);
            }
        }

        function createMarker(add, lat, lng) {


            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(lat, lng),
                animation: google.maps.Animation.DROP,
                icon: icons,
                map: map
            });

            google.maps.event.addListener(marker, 'click', function () {
                infowindow.setContent(add);
                infowindow.open(map, marker);
                marker.setAnimation(google.maps.Animation.BOUNCE);
                setTimeout(function () {
                    marker.setAnimation(null);
                }, 700);
            });

            gmark.push(marker);
            marker.setMap(map);
            bounds.extend(marker.position);

        }


        function getAddress(search) {

            var lat;
            var lng;
            var add = search.split(';')[0];
            var fac = search.split(';')[2];
            if (donefac.indexOf(fac) > -1) {
                //
            } else {
                geocoder.geocode({address: add}, function (results, status) {
                    if (status === google.maps.GeocoderStatus.OK) {

                        var p = results[0].geometry.location;
                        lat = p.lat();
                        lng = p.lng();
                        ser_lat_lng.push([search, lat, lng]);
                        donefac.push(fac);
                    } else {
                        if (status === google.maps.GeocoderStatus.OVER_QUERY_LIMIT) {
                            nextAddress--;
                            delay++;
                        }
                    }
                });
            }
        }


        function theNext(addresses) {

            if (nextAddress < addresses.length - 1) {

                setTimeout(function () {
                    getAddress(addresses[nextAddress]);

                    theNext(addresses);
                }, delay);
                nextAddress++;
            } else {
                ser_lat_lng.map((res) => {
                    var add = res[0].split(';');
                    createMarker(add[1] + " <PRE> <b> " + add[2], res[1], res[2]);
                });
                map.fitBounds(bounds);
                $("#dropinfo").removeClass("loading").show(1000);
                $("#map").removeClass("loading");
                $("button.ui").attr("disabled", false);
                $(".btn-spin").hide(1000);
            }
        }

        function searchFormations() {
            clearMarkers();
            var dropelement = $("#dropinfo");
            dropelement.empty();
            ser_lat_lng = [];
            donefac = [];
            cities = [];
            var maindiv = $("#dropinfo");
            maindiv.hide(500).empty();
            var form = $("#search_form").val();
            var value = $("#filter_input").val();
            var callfun;
            switch (value) {
                case "ville":
                        callfun = "getFormationByCity";
                        break;
                        case "sigle":
                        callfun = "getFormationByCity";
                        break;
                        default:
                        callfun = "getFormationsLikeLabel";
                }
        $.ajax({
        url: "Student",
                data: {"set": callfun, "form_lab": form},
                dataType: "json",
                error: showError,
                success: // La fonction qui traite les résultats
                function (results) {
                var cities = [];
                        var str;
                        var cityc;
                        var sch_name;
                        var div;
                        results.map((res) => {
                            cityc = res.sch.sch_city + " ( " + res.sch.posteCode + " )";
                            sch_name = res.sch.sch_name;
                            str = res.sch.sch_city + ", " + res.sch.sch_country +
                                    " ; " + cityc + ";" + sch_name;
                            cities.push(str);
                            var tt = parse("<div class='col-xs-4 form-line'><header >"
                                    + "<a> %s</a></header><h4><a href='#'>%s</a></h4><p >"
                                    + "%s</p><p >%s"
                                    + "</p></div><div class='col-xs-2 form-line' style='padding-top: 20px;'><span ><img src='images/sch_avatar/%s.png'"
                                    + " alt=''></span><div class='SavoirPlus'><a target='_blank' "
                                    + "href='http://www.google.com/search?q=%s'>"
                                    + "<span>En savoir plus</span></a></div></div><hr>", res.sigle, res.for_intitule, sch_name, cityc, res.sch.sch_id, sch_name);
                            div = $('<div> ' + tt + ' </div>').attr({"id": res.sch.sch_id, "class": "container dropdiv"});
                            maindiv.append(div);
                        });
                    theNext(cities);
                    }
            });
        }
        function searchAllFormations() {
            clearMarkers();
            ser_lat_lng = [];
            donefac = [];
            cities = [];
            var dropelement = $("#dropinfo");
            dropelement.hide(500).empty();
            $.ajax({
                url: "Student",
                data: {"set": "getAllFormations"},
                dataType: "json",
                error: showError,
                success: // La fonction qui traite les résultats
                        function (results) {
                            var cities = [];
                            var str;
                            var cityc;
                            var sch_name;
                            var div;

                            results.map((res) => {
                                cityc = res.sch.sch_city + " ( " + res.sch.posteCode + " )";
                                sch_name = res.sch.sch_name;
                                str = res.sch.sch_city + ", " + res.sch.sch_country +
                                        " ; " + cityc + ";" + sch_name;
                                cities.push(str);
                                var tt = parse("<div class='col-xs-4 form-line'><header >"
                                        + "<a> %s</a></header><h4><a href='#'>%s</a></h4><p >"
                                        + "%s</p><p >%s"
                                        + "</p></div><div class='col-xs-2 form-line' style='padding-top: 20px;'><span ><img src='images/sch_avatar/%s.png'"
                                        + " alt=''></span><div class='SavoirPlus'><a target='_blank' "
                                        + "href='http://www.google.com/search?q=%s'>"
                                        + "<span>En savoir plus</span></a></div></div><hr>", res.sigle, res.for_intitule, sch_name, cityc, res.sch.sch_id, sch_name);
                                div = $('<div> ' + tt + ' </div>').attr({"id": res.sch.sch_id, "class": "container dropdiv"});
                                $("#dropinfo").append(div);

                            });
                            theNext(cities);

                        }
            });
        }

        function parse(str) {
            var args = [].slice.call(arguments, 1),
                    i = 0;

            return str.replace(/%s/g, function () {
                return args[i++];
            });
        }
        
        function getPivotArray(dataArray, rowIndex, colIndex, dataIndex) {
           var result = {}, ret = [];
           var newCols = [];
           for (var i = 0; i < dataArray.length; i++) {
 
               if (!result[dataArray[i][rowIndex]]) {
                   result[dataArray[i][rowIndex]] = {};
               }
               result[dataArray[i][rowIndex]][dataArray[i][colIndex]] = dataArray[i][dataIndex];
 
               //To get column names
               if (newCols.indexOf(dataArray[i][colIndex]) === -1) {
                   newCols.push(dataArray[i][colIndex]);
               }
           }
 
           newCols.sort();
           var item = [];
 
           //Add Header Row
           item.push('Performance');
           item.push.apply(item, newCols);
           ret.push(item);
 
           //Add content 
           for (var key in result) {
               item = [];
               item.push(key);
               for (var i = 0; i < newCols.length; i++) {
                   item.push(result[key][newCols[i]] || 0);
               }
               ret.push(item);
           }
           return ret;
        }
        google.charts.load('visualization', {'packages': ['corechart']});
        google.charts.setOnLoadCallback(initialize);
    </script>

    </body>
</html>